@model IEnumerable<Fall2025_Final_Humbuckers.Models.GlobalTrack>
@using Microsoft.AspNetCore.Identity
@inject SignInManager<Fall2025_Final_Humbuckers.Models.ApplicationUser> SignInManager

@{
    var favoritedTracks = ViewBag.FavoritedTracks as List<string> ?? new List<string>();
}

@foreach (var item in Model)
{
    var trackKey = $"{item.Title}|{item.Artist}";
    var isAlreadyFavorited = favoritedTracks.Contains(trackKey);
    <tr>
        <td>@item.Rank</td>
        <td>
            @if (!string.IsNullOrEmpty(item.AlbumArtUrl))
            {
                <img src="@item.AlbumArtUrl" alt="album art" style="width: 100px; height: 100px; object-fit: cover;" />
            }
        </td>
        <td>@item.Title</td>
        <td>@item.Artist</td>
        <td>@item.Album</td>
        <td>
            <div class="btn-group" role="group">
                @if (!string.IsNullOrEmpty(item.SpotifyUrl))
                {
                    <a href="@item.SpotifyUrl" target="_blank" class="btn btn-sm btn-success">spotify</a>
                }

                @if (SignInManager.IsSignedIn(User))
                {
                    if (isAlreadyFavorited)
                    {
                        <button class="btn btn-sm btn-secondary" disabled>added</button>
                    }
                    else
                    {
                        <button class="btn btn-sm btn-warning add-favorite-btn"
                                data-track-title="@item.Title"
                                data-track-artist="@item.Artist"
                                data-track-album="@item.Album"
                                data-track-spotify="@item.SpotifyUrl"
                                data-track-albumart="@item.AlbumArtUrl"
                                data-track-spotifyid="@item.SpotifyId">
                            add
                        </button>
                    }
                }
                else
                {
                    <a asp-area="Identity" asp-page="/Account/Login" class="btn btn-sm btn-secondary">login</a>
                }
            </div>
        </td>
    </tr>
}
